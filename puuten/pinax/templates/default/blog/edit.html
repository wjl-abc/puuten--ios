{% extends "profiles/base.html" %}

{% load i18n %}
{% load uni_form %}

{% block head_title %}{% blocktrans %}Editing Post{% endblocktrans %}{% endblock %}

{% block body %}
    {% ifequal post.author request.user %}
        <script type="text/javascript">
        $(document).ready(function(){
        	$('#div_id_latitude').hide(); 
            $('#div_id_longitude').hide();
     //       $('#div_id_tags').hide();
            $('#div_id_owner_id').hide();
            if({{post.owner_type}}==1){
                var map = initialize({{post.latitude}},{{post.longitude}},10);
                set_marker($('#id_latitude'), $('#id_longitude'), {{post.latitude}},{{post.longitude}}, map);
            }
            $(":checkbox").click(function(){
                var str="";
                $("[name=items]:checkbox:checked").each(function(){
                    str+=$(this).val()+",";
                })
                $("#id_tags").val(str);
            });
          });
   		</script>
        <form class="uniForm" id="edit-blog" method="POST" action="">
            <fieldset class="inlineLabels">
                {{ blog_form|as_uni_form }} 
                
                {% ifequal post.owner_type 1 %}
                    <div id="map_canvas" style="width:600px; height:500px"></div>
                {% endifequal %}
                <div class="form_block">
                <input type="hidden" name="action" value="update" />
                <input type="submit" value="{% trans "Update" %}"/>
                </div>
            </fieldset>
        </form>
    {% else %}
    <p>{% trans "You are not the author of this post" %}</p>
    {% endifequal %}
{% endblock %}

{% block extra_body %}
    {% load jquery_validation %}
    {% include_validation %}
    <link rel="stylesheet" href="{{ STATIC_URL }}/kindeditor/themes/default/default.css" />
	<script charset="utf-8" src="{{ STATIC_URL }}/kindeditor/kindeditor.js"></script>
	<script charset="utf-8" src="{{ STATIC_URL }}/kindeditor/lang/zh_CN.js"></script>
	<script>
			var editor;
			KindEditor.ready(function(K) {
					editor = K.create('#id_body');
			});
	</script>
    <script type="text/javascript">
        $(function(){
            $('#blog_form').validate('{% url blog_form_validate %}', {type: 'table'});
        });
    </script>
{% endblock %}
