{% extends "profiles/base_new.html" %}

{% load uni_form %}
{% load i18n %}
{% load humanize %}
{% load comments_tag %}
{% load tagging_tags %}
{% load blog_tags %}
{% load theme_tags %}
{% load threadedcommentstags %}

{% block head_title %}{% blocktrans %}Blog Post{% endblocktrans %} : {{ post.title }}{% endblock %}

{% block extra_head %}
    <link rel="alternate" type="application/atom+xml" title="Blog Post Feed for All Users" href="/feeds/posts/all/" />
    <link rel="alternate" type="application/atom+xml" title="Blog Post Feed for User {{ post.author.username }}" href="/feeds/posts/only/{{ post.author.username }}/" />
{% endblock %}

{% block body %}
    <script type="text/javascript">
    	var map;
	    $(document).ready(function(){
    	    map = initialize({{post.latitude}}, {{post.longitude}}, 12);
    	    show_marker({{post.latitude}}, {{post.longitude}}, map);  	    
    	});
    </script>
    <form class="uniForm" id="edit-profile" method="POST" action="">
        <div class="blog-post">
            <p>{% show_blog_post post %}</p>
            {% if glued_stuff %}
                {% for instance in glued_stuff %}
                    <a href="{{ instance.get_absolute_url }}">{{ instance.title }}</a>
                {% endfor %}
            {% endif %}
            <div id="map_canvas" style="width:600px; height:500px"></div>
            {% ifequal post.owner_type 1 %}
                <div class="blog-meta"><p>Posted by: <a href="{% url profile_detail post.author.id %}">{{ post.author.username }}</a> on {{ post.publish|date }}</p></div> 
            {% endifequal %}
            {% ifequal post.owner_type 2 %}
                <div class="blog-meta"><p>Posted by: <a href="{{ business.get_absolute_url }}">{{ business.name }}</a> on {{ post.publish|date }}</p></div>
            {% endifequal %}
            {% ifequal post.author request.user %}
                <a href="{% url blog_edit post.id %}">{% trans "Edit Post" %}</a><br />
            {% endifequal %}
            {% ifnotequal post.author request.user %}
                <div class="form_block">
                   <input type="hidden" name="action" value="share" />
                   <input type="submit" value="{% trans 'share' %}" />
                </div><br />
            {% endifnotequal %}
            <a href="{% url blog_glue %}?a_id={{post.id}}&a_type={{ post.get_type }}">Glue with post</a><br />
            <a href="{% url photo_glue %}?a_id={{post.id}}&a_type={{ post.get_type }}">Glue with photo</a>
        </div>
    </form>
    <a>{% get_comment_count for post as commentcount %} {{ commentcount }} Comments</a>
    {% comments post %}
{% endblock %}
