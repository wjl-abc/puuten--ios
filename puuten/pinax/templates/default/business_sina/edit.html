{% extends "business/base.html" %}

{% load i18n %}
{% load uni_form %}

{% block head_title %}{% blocktrans %}Edit Business From Sina{% endblocktrans %}{% endblock %}
{% block js %}
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/api?key=3690f5facff0a96fc7ff291c20f532e0&v=1.0&services=true" ></script> 
    <script type="text/javascript" src="{{ STATIC_URL }}pinax/js/blog.location.js"></script> 
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=1.3"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}pinax/js/baidu_map.js"></script> 
    <script type="text/javascript" src="{{ STATIC_URL }}pinax/js/jquery-1.6.1.min.js"></script> 
{% endblock %}

{% block body %}
    <script type="text/javascript">  
        function MblogDotccMap(keyword){
	        var map = new BMap.Map("MblogMap");          
	        var point = new BMap.Point(116.407413, 39.904214);  
	
	        map.centerAndZoom(point, 11);                 
	        map.addControl(new BMap.NavigationControl());  
	        map.addControl(new BMap.ScaleControl());  
	        map.addControl(new BMap.OverviewMapControl());
	        
	        var myGeo = new BMap.Geocoder();
	        var local = new BMap.LocalSearch(map, {renderOptions: {map: map, panel: "results_info"}});
	        local.search(keyword); 
	        local.getResults()
	        local.setSearchCompleteCallback(function(searchResult){
	        	var num_pois = searchResult.getNumPois()
	        	if(num_pois>0){
			        var poi = searchResult.getPoi(0);
			        $("#lat").val(poi.point.lat);
			        $("#lng").val(poi.point.lng);
	        	}	
	        });
        }
    </script> 

<body onload="MblogDotccMap();" onkeydown="if(event.keyCode==13)MblogDotccMap(document.getElementById('keyword').value)">
<h1>{{business_from_sina.name}}</h1>
<a>{{business_from_sina.introduction}}</a>
<div style="width:600px;height:450px;border:1px solid gray; float:left" id="MblogMap"></div>
<div style="margin-top:10px; margin-left:10px; float:left">
	<div id="search" style="margin-top:10px; margin-left:10px;">搜索：<input type="text" size="20" name="keyword" id="keyword" /> <input type="submit" value="提交" onclick="MblogDotccMap(document.getElementById('keyword').value)" /></div>
	<div id="results_info" style="margin-top:10px; margin-left:10px;"></div>
	<form class="uniForm" id="new_business_sina" method="POST" action="">
        <fieldset class="inlineLabels">
            <a>New Name:</a><input id="new_name" name="new_name" class="textinput"><br>
	        <a>lat</a><input id="lat" name="lat" class="textinput">
	        <a>lng</a><input id="lng" name="lng" class="textinput">
	        <div class="form_block">
                <input type="hidden" name="action" value="submit" />
                <input type="submit" value="{% trans "create" %}" />
            </div>
	    </fieldset>
	</form>
</div>
</body>
 
{% endblock %}
